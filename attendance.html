<!DOCTYPE html>
<html>
<head>
  <title>Attendance with Address</title>
  <script>
    const formBaseURL = "https://docs.google.com/forms/d/e/1FAIpQLSeGF_imyOBuVkD8hFOefWB2wNmSnSKKjbANB76pxMafSz8ljg/viewform";
    
    const rollKey = "entry.846968130";      // Roll No key
    const locationKey = "entry.718692023";  // Location key (now address)

    function openFormWithLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          // Reverse geocoding using OpenStreetMap
          const geoUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;

          try {
            const response = await fetch(geoUrl);
            const data = await response.json();
            const address = data.display_name;

            const url = formBaseURL +
              "?usp=pp_url" +
              "&" + rollKey + "=" +
              "&" + locationKey + "=" + encodeURIComponent(address);

            window.location.href = url;

          } catch (err) {
            alert("Failed to get address. Please check your internet connection.");
          }

        }, () => {
          alert("Location permission denied.");
        });
      } else {
        alert("Geolocation not supported.");
      }
    }

    window.onload = openFormWithLocation;
  </script>
</head>
<body>
  <h2>Loading Attendance Form...</h2>
  <p>Please allow location access...</p>
</body>
</html>
